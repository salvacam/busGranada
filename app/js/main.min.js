document.addEventListener("DOMContentLoaded",function(){app.inicio()});var app={URL_SERVER:"https://calcicolous-moonlig.000webhostapp.com/horarios/index.php?parada=",timeOuts:[],cargando:document.getElementById("cargando"),operacion:document.getElementById("operacion"),hora:document.getElementById("hora"),tablaResultado:document.getElementById("tablaResultado"),cabeceraTabla:document.getElementById("cabeceraTabla").classList,posicionInicial:-1,posicion:-1,inicio:function(){document.getElementById("parada").focus(),document.addEventListener("keydown",app.manejarTeclado)},manejarTeclado:function(e){"Enter"===e.key&&app.mostrar(),"ArrowDown"===e.key&&(e.preventDefault(),app.moverFoco(1)),"ArrowUp"===e.key&&(e.preventDefault(),app.subirFoco())},moverFoco:function(e){app.posicion=app.posicion+e,void 0!==document.getElementsByClassName("resultado")[app.posicion]?(document.getElementsByClassName("resultado")[app.posicion].scrollIntoView(),document.getElementById("parada").blur(),document.getElementsByClassName("resultado")[app.posicion].focus()):(app.posicion=app.posicionInicial,document.documentElement.scrollTop=0,document.getElementById("parada").focus())},subirFoco:function(){app.posicion=app.posicionInicial,document.documentElement.scrollTop=0,document.getElementById("parada").focus()},mostrar:function(){app.posicion=app.posicionInicial;var e=document.getElementById("parada").value;if(""===e)return alert("Debes introducir un n√∫mero de parada"),void document.getElementById("parada").focus();document.querySelector(".parada")&&(document.querySelector(".parada").classList.toggle("disabled"),document.querySelector(".parada").removeEventListener("click",app.mostrarFavorito)),app.cargando.classList.toggle("hide");var a=app.URL_SERVER+e;fetch(a).then(function(a){if(200!==a.status)return void app.fn_errorXHR();a.json().then(function(a){app.renderResult(a,e)})}).catch(function(e){app.fn_errorXHR()})},fn_errorXHR:function(){document.querySelector(".parada")&&(document.querySelector(".parada").classList.toggle("disabled"),document.querySelector(".parada").addEventListener("click",app.mostrarFavorito)),app.cargando.classList.toggle("hide")},renderResult:function(e,a){if(document.querySelector(".parada")&&(document.querySelector(".parada").classList.toggle("disabled"),document.querySelector(".parada").addEventListener("click",app.mostrarFavorito)),app.cargando.classList.toggle("hide"),e.hasOwnProperty("error"))return app.operacion.textContent=e.error,!1;if(e.length<1)return app.operacion.textContent="No hay bus acercandose",!1;app.operacion.textContent="";var t=new Date;for(app.hora.textContent="Parada "+a+", a las "+t.getHours()+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());app.tablaResultado.firstChild;)app.tablaResultado.removeChild(app.tablaResultado.firstChild);app.cabeceraTabla.remove("hide"),document.getElementById("resultado").className="",e.forEach(function(e){var a=document.createElement("tr");a.classList.add("resultado");for(var t in e){var o=document.createElement("td");o.textContent=e[t],a.appendChild(o)}app.tablaResultado.appendChild(a)})}};